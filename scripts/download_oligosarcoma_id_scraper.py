#!/usr/bin/env python

import urllib.request
import re
from tqdm import tqdm
import time


ids = ["GSM5720455", "GSM5720456", "GSM5720457", "GSM5720458", "GSM5720459", "GSM5720460", "GSM5720461", "GSM5720462", "GSM5720463", "GSM5720464", "GSM5720465", "GSM5720466", "GSM5720467", "GSM5720468", "GSM5720469", "GSM5720470", "GSM5720471", "GSM5720472", "GSM5720473", "GSM5720474", "GSM5720475", "GSM5720476", "GSM5720477", "GSM5720478", "GSM5720479", "GSM5720480", "GSM5720481", "GSM5720482", "GSM5720483", "GSM5720484", "GSM5720485", "GSM5720486", "GSM5720487", "GSM5720488", "GSM5720489", "GSM5720490", "GSM5720491", "GSM5720492", "GSM5720493", "GSM5720494", "GSM5720495", "GSM5720496", "GSM5720497", "GSM5720498", "GSM5720499", "GSM5720500", "GSM5720501", "GSM5720502", "GSM5720503", "GSM5720504", "GSM5720505", "GSM5720506", "GSM5720507", "GSM5720508", "GSM5720509", "GSM5720510", "GSM5720511", "GSM5720512", "GSM5720513", "GSM5720514", "GSM5720515", "GSM5720516", "GSM5720517", "GSM5720518", "GSM5720519", "GSM5720520", "GSM5720521", "GSM5720522", "GSM5720523", "GSM5720524", "GSM5720525", "GSM5720526", "GSM5720527", "GSM5720528", "GSM5720529", "GSM5720530", "GSM5720531", "GSM5720532", "GSM5720533", "GSM5720534", "GSM5720535", "GSM5720536", "GSM5720537", "GSM5720538", "GSM5720539", "GSM5720540", "GSM5720541", "GSM5720542", "GSM5720543", "GSM5720544", "GSM5720545", "GSM5720546", "GSM5720547", "GSM5720548", "GSM5720549", "GSM5720550", "GSM5720551", "GSM5720552", "GSM5720553", "GSM5720554", "GSM5720555", "GSM5720556", "GSM5720557", "GSM5720558", "GSM5720559", "GSM5720560", "GSM5720561", "GSM5720562", "GSM5720563", "GSM5720564", "GSM5720565", "GSM5720566", "GSM5720567", "GSM5720568", "GSM5720569", "GSM5720570", "GSM5720571", "GSM5720572", "GSM5720573", "GSM5720574", "GSM5720575", "GSM5720576", "GSM5720577", "GSM5720578", "GSM5720579", "GSM5720580", "GSM5720581", "GSM5720582", "GSM5720583", "GSM5720584", "GSM5720585", "GSM5720586", "GSM5720587", "GSM5720588", "GSM5720589", "GSM5720590", "GSM5720591", "GSM5720592", "GSM5720593", "GSM5720594", "GSM5720595", "GSM5720596", "GSM5720597", "GSM5720598", "GSM5720599", "GSM5720600", "GSM5720601", "GSM5720602", "GSM5720603", "GSM5720604", "GSM5720605", "GSM5720606", "GSM5720607", "GSM5720608", "GSM5720609", "GSM5720610", "GSM5720611", "GSM5720612", "GSM5720613", "GSM5720614", "GSM5720615", "GSM5720616", "GSM5720617", "GSM5720618", "GSM5720619", "GSM5720620", "GSM5720621", "GSM5720622", "GSM5720623", "GSM5720624", "GSM5720625", "GSM5720626", "GSM5720627", "GSM5720628", "GSM5720629", "GSM5720630", "GSM5720631", "GSM5720632", "GSM5720633", "GSM5720634", "GSM5720635", "GSM5720636", "GSM5720637", "GSM5720638", "GSM5720639", "GSM5720640", "GSM5720641", "GSM5720642", "GSM5720643", "GSM5720644", "GSM5720645", "GSM5720646", "GSM5720647", "GSM5720648", "GSM5720649", "GSM5720650", "GSM5720651", "GSM5720652", "GSM5720653", "GSM5720654", "GSM5720655", "GSM5720656" ]


with open("output/tables/download_oligosarcoma_geo_ids.txt", "w") as fh:
    for geo_id in tqdm(ids):
        url = "https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=" + geo_id
        

        response = urllib.request.urlopen(url)
        data = response.read()      # a `bytes` object
        text = data.decode('utf-8') # a `str`; this step can't be used if data is binary
        
        paper_id = re.search("case_number_fig1:[ ]+([0-9]+)", text)
        if paper_id:
            paper_id = paper_id.group(1)
            print(geo_id + "\t" + paper_id)
        else:
            print("N/A for: "+geo_id)
            paper_id = "NA"



        fh.write(geo_id + "\t" + paper_id + "\n")
        
        time.sleep(1.5)
